const app={manifest:Object.assign({},...[...document.currentScript.attributes].map((t=>({[t.name]:t.value})))),src:document.currentScript.src,components:{},defineComponent:(t,e)=>(app.components[t.toUpperCase()]=e,app),attributes:[],defineAttribute:(t={})=>(app.attributes.push(t),app),variables:{},logStack:[],loadingScreen:"..."};app.defineAttribute({name:"execon",match:"*",parser(t,e){this[t.replace("exec","")]=()=>{document.querySelectorAll(this.getAttribute("for")).forEach((t=>t.setAttribute("execute",e)))}}}),app.defineAttribute({name:"execute",match:"*",parser(t,e){this.removeAttribute(t),app.executeEvent.apply(this,[e,t.split(".")])}}),app.defineAttribute({name:"on.",match:"*",parser(t,e){let a=t.split(".").filter((t=>t));a.shift(),this["on"+a.shift()]=t=>{this.event=t,app.executeEvent.apply(this,[e,a])}}}),app.executeEvent=function(t="",e=[]){e.includes("prevent")&&event.preventDefault(),e.includes("clear")&&this.set({value:""}),e.includes("blur")&&this.blur(),e.includes("script")?this.insertAdjacentHTML("beforeend",`<script>${t}<\/script>`):t.trim()in app.functions?this.insertAdjacentHTML("beforeend",`<script>${app.functions[t.trim()]}<\/script>`):(this.set({insert:"end",value:app.insert({string:t,values:app.prefix("this.",app.sumup(this))})}),e.includes("clear")&&"value"in this&&(this.value=""))},app.defineAttribute({name:"src",match:"*",parser(t,e){if(e.startsWith("https://")||e.startsWith("http://"))return;let a=this.closest("[scope]")?this.closest("[scope]").getAttribute("scope"):location.href;this.setAttribute(t,new URL(e,a).href)}}),app.defineAttribute({name:"href",match:"*",parser(t,e){if(e.startsWith("https://")||e.startsWith("http://"))return;let a=this.closest("[scope]")?this.closest("[scope]").getAttribute("scope"):location.href;this.setAttribute(t,new URL(e,a).href)}}),app.defineAttribute({name:"#",match:"*",parser(t){this.removeAttribute(t),this.id=t.slice(1),window[this.id]=this}}),app.defineAttribute({name:".",match:"*",parser(t){this.removeAttribute(t),this.classList.add(...t.split(".").filter((t=>t)))}}),app.defineAttribute({name:"-",match:"*",parser(t,e){this.removeAttribute(t),t.startsWith("--")?this.style.setProperty(t,e):this.style[t.slice(1)]=app.stylar(e,this)}}),app.defineAttribute({name:"target",match:"*:not(get)",parser(t,e){this.removeAttribute(t),this.remove(),document.querySelectorAll(e).forEach((t=>{let e=this.cloneNode(!0);t.insertAdjacentElement("beforeend",e),app.mutation.core([e])}))}}),app.defineAttribute({name:"accent",match:"*",parser(t,e){this.style.setProperty("--accent",e.trim().replace(/--\w+/g,((t,e,a)=>a.substring(0,e).trim().endsWith("var(")?t:"var("+t+")")))}}),app.themes={light:{text:"#454545",background:"#ffffff",foreground:"#cecece",shadow:"#00000020"},dark:{text:"#cccccc",background:"#101010",foreground:"#202020",shadow:"#00000080"},oled:{text:"#bbbbbb",background:"#000000",foreground:"#101010",shadow:"#ffffff20"}},app.defineAttribute({name:"theme",match:"*",parser(t,e){if("system"==e);else{if(!(e in app.themes))return;this.style.setProperty("--text",app.themes[e].text),this.style.setProperty("--background",app.themes[e].background),this.style.setProperty("--foreground",app.themes[e].foreground),this.style.setProperty("--shadow",app.themes[e].shadow),this.style.backgroundColor="var(--background)",this.style.color="var(--text)"}}}),app.functions={},app.defineComponent("script",(function(){let t=this.type||"async",e=this.innerText;if(e&&this.id)return app.functions[this.id]=e,void this.remove();let a=Object.keys(app.variables).map((t=>`let ${t} = app.clone(app.variables["${t}"])`)).join(";")+";const echo=e=>arguments[0].insertAdjacentHTML('beforebegin',e);",r="\n"+Object.keys(app.variables).map((t=>`app.compare("${t}",${t})`)).join(";");if(!e||"sync"!=t)return e&&"async"==t&&Function(`return async function(){${a}${e}${r}\n  }`)().apply(this.parentElement,[this]).then((t=>this.remove())),"";this.outerHTML=Function(`return function(){${a}${e}${r}\n    }`)().apply(this.parentElement)||""})),app.clone=function(t){return"object"==typeof t?JSON.parse(JSON.stringify(t)):t},app.compare=function(t,e){JSON.stringify(app.variables[t])!==JSON.stringify(e)&&(app.variables[t]=e,app.refresh(t))},app.defineComponent("style",(function(){let t=this.getAttribute("value");return this.id?t=t.replaceAll("this","#"+this.id):(this.parentElement.hasAttribute("sid")||this.parentElement.setAttribute("sid",Math.random()),t=t.replaceAll("this",'[sid="'+this.parentElement.getAttribute("sid")+'"]').trim().replace(/--\w+/g,((t,e,a)=>a.substring(0,e).trim().endsWith("var(")?t:"var("+t+")"))),t})),app.importers={picco:{pre:new URL("libs/",app.src).href,post:".js"},unpkg:{pre:"https://unpkg.com/",post:".js"}},app.defineComponent("import",(function(){let t=this.parentElement,e=this.getAttribute("from");e in app.importers&&this.setAttribute("from",app.importers[e].pre),this.setAttribute("from",new URL((this.getAttribute("from")||"..")+"/",t.closest("[scope]")?t.closest("[scope]").getAttribute("scope"):location.href).href),this.remove();let a=t.innerHTML;t.innerHTML=this.innerHTML||app.loadingScreen,app.loadingScreen=t.innerHTML;let r=this.getAttribute("libs").split(",").filter((t=>t)).map((t=>new URL(t.trim(),this.getAttribute("from")).href+(e in app.importers?app.importers[e].post:"")));Promise.all(r.map((t=>app.cache(t)))).then((e=>{t.innerHTML=e.map(((t,e)=>{let a=r[e].split(".").pop();if(["css","sass","scss","less","csx"].includes(a))return`<style>${t}</style>`;if(["js","ts","jsx","tsx","pi","pix"].includes(a))return`<script scope="${r[e]}" type=sync>${t}<\/script>`;if(["txt","json","xml"].includes(a)){try{t=JSON.parse(t)}catch(t){}return app.variables[this.getAttribute("as")||"e"]=t,`<script type=sync>${app.variables[this.getAttribute("as")||"e"]}=${app.variables[this.getAttribute("as")||"undefined"]}<\/script>`}{let a=document.createElement("e");return a.innerHTML=t,[...a.children].forEach((t=>t.setAttribute("scope",r[e]))),a.innerHTML}})).join("")+a}))})),app.defineAttribute({name:"from",match:"*:not(import)",parser(t,e){if(!(e in app.variables)){try{Function(`let ${e};`)}catch(t){return void console.error(`"${e}" is not a valid variable name`)}app.variables[e]=null}app.refresh(e)}}),app.sync={local:{},session:{}},app.defineComponent("create",(function(){let t=this.getAttribute("var");app.mutation.core([...this.children]),this.remove();try{Function(`let ${this.getAttribute("var")};`)}catch(t){return void console.error(`"${this.getAttribute("var")}" is not a valid variable name`)}if(this.getAttribute("sync")){let e=this.getAttribute("sync");"session"==e&&(app.sync.session[t]=!0,this.innerHTML=sessionStorage[t]||this.innerHTML),"local"==e&&(app.sync.local[t]=!0,this.innerHTML=localStorage[t]||this.innerHTML)}let e=this.innerHTML;try{e=JSON.parse(e)}catch(t){}app.variables[this.getAttribute("var").trim()]=e,app.refresh(this.getAttribute("var").trim())})),app.mutation={core:function(t){t.forEach((t=>{if("DEFINE"==t.tagName)return app.mutation.define(t),void t.remove();if(String(t.tagName).startsWith("V:"))return app.mutation.core([...t.children]),void(t.outerHTML=app.setVarData(app.sumup(t,"attrs"),t));if([...t.attributes||[]].map((e=>app.mutation.attr({attr:e.name,value:e.value,target:t}))),t.isConnected){if(t.tagName in app.components){t.hasAttribute("value")||t.setAttribute("value",t.value||t.innerHTML);let e=String(app.components[t.tagName].apply(t)||"");void 0!==e&&(t.innerHTML=e)}t.tagName&&t.isConnected&&app.mutation.core([...t.children])}}))},attr(t){for(let e=0;e<app.attributes.length&&t.target.isConnected;e++){let a=app.attributes[e];if(t.attr.startsWith(a.name)&&t.target.matches(a.match)&&a.parser.apply(t.target,[t.attr,t.value]),!t.target.isConnected)break}}},app.observer=new MutationObserver((t=>{t.forEach((t=>{"loading"!==document.readyState?"childList"==t.type?app.mutation.core([...t.addedNodes||[]]):t.target.hasAttribute(t.attributeName)&&app.mutation.attr({target:t.target,attr:t.attributeName,value:t.target.getAttribute(t.attributeName)}):"childList"==t.type&&[...t.addedNodes||[]].filter((t=>"SCRIPT"==t.tagName&&t.matches("body script"))).map((t=>t.type=t.type||"async"))}))})),app.mutation.define=function(t){t.getAttribute("component")&&app.defineComponent(t.getAttribute("component"),(function(){return app.insert({string:t.innerHTML,values:app.prefix(t.getAttribute("component")+".",app.sumup(this))})})),t.getAttribute("attribute")&&app.defineAttribute({name:t.getAttribute("attribute"),match:t.getAttribute("match")||"*",parser(e,a){this.insertAdjacentHTML("beforeend",app.insert({string:t.innerHTML,values:app.prefix(t.getAttribute("attribute"),{name:e,value:a})}))}})},Element.prototype.get=function(t={},...e){let a=t.target&&document.querySelector(t.target)||this;return"value"in a&&a.setAttribute("value",a.value),t.attr||t.attribute?a.getAttribute(t.attr||t.attribute)||t.value:t.style||t.css?a.style[t.style||t.css]||t.value:app.components[a.tagName]?(app.diff(a),a.getAttribute("value")||a.innerHTML||t.value):a.innerHTML||t.value},app.defineComponent("get",(function(){return this.outerHTML=this.parentElement.get(app.sumup(this,"attrs")),""})),Element.prototype.set=function(t,...e){if(t.attr||t.attribute)this.setAttribute(t.attr||t.attribute,t.value),"value"!=t.attr&&"value"!=t.attribute||!("value"in this)||(this.value=t.value);else if(t.css||t.style)this.style[t.css||t.style]=app.stylar(t.value,this);else if("before"==t.insert||"after"==t.insert)this.insertAdjacentHTML("before"==t.insert?"beforebegin":"afterend",t.value);else if(app.components[this.tagName]){app.diff(this);let e=this.getAttribute("value")||this.innerHTML;"start"==t.insert?e=t.value+e:"end"==t.insert?e+=t.value:e=t.value,this.setAttribute("value",e),app.mutation.core([this])}else"start"==t.insert||"end"==t.insert?this.insertAdjacentHTML("start"==t.insert?"afterbegin":"beforeend",t.value):this.innerHTML=t.value;return e.length&&e.forEach((t=>this.set(t))),this},app.defineComponent("set",(function(){let t=this.parentElement;(this.getAttribute("attr")||this.getAttribute("attribute")||this.getAttribute("style")||this.getAttribute("css")||this.getAttribute("var"))&&app.mutation.core([...this.children]),this.setAttribute("value",this.innerHTML.trim()),this.remove(),t.set(app.sumup(this,"attrs"))})),Element.prototype.remove=function(t={},...e){try{t.attr||t.attribute?this.removeAttribute(t.attr||t.attribute):t.css||t.style?this.style[t.css||t.style]="initial":this.outerHTML=t.value||""}catch(t){app.logStack.push(t)}return this},app.defineComponent("remove",(function(){let t=this.parentElement;this.remove(),t.remove(app.sumup(this,"attrs"))})),app.getVarData=function(t,e){let a=app.variables[t];if("object"!=typeof a||null===a)return String(a)},app.set={},app.setVarData=function(t){let e=t.tagName.toLowerCase().replace("v:","");delete t.tagName;let a=t.value;if(delete t.value,!(e in app.variables))return"";if(t.get)return app.getVarData(e,t.get);if("number"==typeof app.variables[e]&&app.set.number(e,t,a),"string"==typeof app.variables[e]&&app.set.string(e,t,a),"boolean"==typeof app.variables[e]&&app.set.bool(e,t,a),"object"==typeof app.variables[e]){try{a=JSON.parse(a)}catch(t){}null===app.variables[e]||0===Object.keys(t).length?app.variables[e]=a:Array.isArray(app.variables[e])?app.set.array(e,t,a):app.set.object(e,t,a)}return app.refresh(e),""},app.set.number=function(t,e,a){""===a&&(a=1),a-=0,Number.isNaN(a)||(0===Object.keys(e).length&&(app.variables[t]=a),"times"in e&&(app.variables[t]*=a),"divide"in e&&(app.variables[t]/=a),"plus"in e&&(app.variables[t]+=a),"minus"in e&&(app.variables[t]-=a))},app.set.string=function(t,e,a){0===Object.keys(e).length&&(app.variables[t]=a),"replace"in e&&(app.variables[t]=app.variables[t].replace(e.replace,a)),"replaceall"in e&&(app.variables[t]=app.variables[t].replaceAll(e.replaceall,a)),"match"in e&&(app.variables[t]=app.variables[t].replace(new RegExp(e.match,e.flags||""),(t=>a.replaceAll("((match))",t)))),"end"==e.insert&&(app.variables[t]=app.variables[t]+a),"start"==e.insert&&(app.variables[t]=a+app.variables[t])},app.set.bool=function(t,e,a){app.variables[t]="toggle"in e?!app.variables[t]:"true"==a.trim().toLowerCase()},app.set.object=function(t,e,a){try{Function("app.variables[arguments[0]]"+(e.key||"").split(".").filter((t=>t)).map((t=>Number.isNaN(t-0)?`["${t}"]`:`[${t}]`)).join("")+"=arguments[1]")(t,a)}catch(t){console.log(t)}},app.set.array=function(t,e,a){"push"in e&&app.variables[t].push(a),"unshift"in e&&app.variables[t].unshift(a),e.index&&(app.variables[t][e.index]=a)},app.refresh=function(t){let e=JSON.stringify(app.variables[t]);t in app.sync.session&&(sessionStorage[t]=e),t in app.sync.local&&(localStorage[t]=e),document.body.querySelectorAll(`[from="${t}"]`).forEach((a=>{a.getAttribute("cache")!==e&&(a.setAttribute("cache",e),a.getAttribute("template")||a.setAttribute("template",a.innerHTML),a.set({value:app.flatten(app.variables[t]).map((e=>app.insert({string:a.getAttribute("template"),values:app.prefix(t+".",e)}))).join("")}))}))},app.cache=async function(t){if((t=new URL(t,app.src).href)in sessionStorage)return sessionStorage[t];let e=await app.fetch(t);return e.error?await app.cache(t):e.ok?(sessionStorage[t]=e.text,e.text):""},app.cenv=function(t,e="",a={}){let r=!1;try{r=Function(`${Object.keys(app.variables).map((t=>`let ${t}=app.variables.${t}`)).join(";")};return ${e}`).apply(app.sumup(t))}catch(t){}return r},app.defineAttribute({name:"if",match:"*",parser(t,e){app.cenv(this.parentElement,e)||this.remove()}}),app.diff=function(t){let e=t.getAttribute("value"),a=(t.innerHTML,document.createElement("temp"));return a.innerHTML=e,[...a.children].forEach((e=>t.querySelector(e.tagName.toLowerCase())?"":e.remove())),t.setAttribute("value",a.innerHTML),app},app.fetch=function(t="",e={}){return new Promise((a=>{let r=new XMLHttpRequest;r.open(e.method||"GET",new URL(t,e.base||location.href).href),r.responseType="arraybuffer",r.addEventListener("load",(async t=>{let e={};e.buffer=r.response,e.text=await new Blob([e.buffer]).text();try{e.json=JSON.parse(e.text)}catch(t){}e.url=r.responseURL,e.status=r.status,e.statusText=r.statusText,e.ok=e.status>199&&e.status<300,e.request=r,a(e)})),r.addEventListener("error",(e=>{a({status:0,error:"failed to fetch",url:t,request:r})})),r.send(e.body||null)}))},app.flatten=function(t){return Array.isArray(t)||(t=[t]),t=(t=t.map((t=>"object"!=typeof t||"object"==typeof t&&null===t?{value:t}:t))).map((t=>{let e={},a=(t,r)=>{for(let i in t)"object"!=typeof t[i]||null===t[i]?e[r+i]=t[i]:t[i]instanceof Array?(e[r+i+".length"]=t[i].length,t[i].map(((t,s)=>{"object"!=typeof t||null===t?e[r+i+"."+s]=t:a(t,r+i+"."+s+".")}))):a(t[i],r+i+".")};return a(t,""),e}))},app.insert=function(t={}){return String(t.string).replace(/\(\(.*?\)\)/gi,(e=>{let a=e.slice(2,-2);return a in t.values?t.values[a]:e}))},app.prefix=function(t,e){return Object.assign({},...Object.entries(e).map((e=>({[t+e[0]]:e[1]}))))},app.stylar=function(t="",e=document.body){return t=t.replace(/\-\-\w+/gi,((t,e,a)=>a.substring(0,e).trim().endsWith("var(")?t:"var("+t+")")).replace(/url\(.*?\)/gi,(t=>{let a=e.closest("[scope]")?e.closest("[scope]").getAttribute("scope"):location.href;return t.replace(t.slice(4,-1).trim(),new URL(t.slice(4,-1).trim(),a).href)}))},app.sumup=function(t,e){let a={};return[...t.attributes].forEach((t=>a[t.name]=t.value)),a.value=t.value||a.value||t.innerHTML.trim(),a.tagName=t.tagName,"attrs"==e||(a.style={},(t.getAttribute("style")||"").split(";").filter((t=>t)).map((t=>{t=t.split(":"),a.style[t[0]]=t[1],a["style."+t[0]]=t[1]})),a.event=t.event||{}),a},app.observer.observe(document.documentElement,{childList:!0,attributes:!0,subtree:!0}),document.addEventListener("DOMContentLoaded",(function(){document.body.hasAttribute("theme")||document.body.setAttribute("theme","light"),document.body.hasAttribute("accent")||document.body.setAttribute("accent","#e91e63");let t=app.manifest.icon?new URL(app.manifest.icon,location.href).href:new URL("/favicon.ico",app.src).href;document.head.insertAdjacentHTML("beforeend",`\n     <meta name="viewport" content="width=device-width, initial-scale=1">\n     <meta name=theme-color content="${document.body.getAttribute("accent")}">\n     <meta name="color-scheme" content="${"light"==document.body.getAttribute("theme")?"light dark":"dark light"}">\n\n     <link rel=icon href="${t}">\n     \n     \n    `),document.title=document.title||app.manifest.title||"Picco App",app.mutation.core([document.body])}));